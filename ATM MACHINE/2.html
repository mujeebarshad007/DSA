<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NIKO'S REAL ATM - Special Case</title>
        <style>
        /* --- RESET & BASIC SETUP --- */
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #1a1a1a;
            background-image: radial-gradient(#2c3e50 15%, #000 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* --- THE ATM CHASSIS (PHYSICAL MACHINE) --- */
        .atm-chassis {
            width: 100%;
            max-width: 950px;
            background: linear-gradient(145deg, #bdc3c7, #95a5a6);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 
                0 30px 60px rgba(0,0,0,0.8),
                inset 0 2px 5px rgba(255,255,255,0.4);
            border: 4px solid #7f8c8d;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .atm-chassis { grid-template-columns: 1fr; }
        }

        /* --- LEFT SIDE: THE MONITOR --- */
        .monitor-bezel {
            background: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            border: 2px solid #34495e;
            position: relative;
        }

        .brand-logo {
            color: white;
            text-align: center;
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }

        .screen-container {
            background: #000;
            height: 480px;
            width: 100%;
            position: relative;
            overflow: hidden;
            border: 1px solid #555;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.9);
            /* Scanline effect */
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        /* --- SCREEN CONTENT STYLING --- */
        .screen {
            display: none;
            padding: 20px;
            height: 100%;
            color: #00ff00; /* Classic Terminal Green */
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px #00ff00;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .screen.active { display: flex; animation: flickOn 0.2s ease-in; }

        @keyframes flickOn {
            0% { opacity: 0; }
            50% { opacity: 1; }
            52% { opacity: 0.2; }
            100% { opacity: 1; }
        }

        .screen h2 {
            font-size: 24px;
            border-bottom: 2px solid #00ff00;
            margin-bottom: 20px;
            padding-bottom: 5px;
            width: 100%;
            text-align: center;
        }

        /* --- SCREEN BUTTONS --- */
        .screen-btn {
            background: transparent;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 12px 20px;
            width: 90%;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            text-align: left;
            position: relative;
        }

        .screen-btn:hover {
            background: #00ff00;
            color: #000;
        }

        .screen-btn::before {
            content: '>';
            margin-right: 10px;
        }

        /* --- RIGHT SIDE: HARDWARE --- */
        .hardware-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .slot-group {
            background: #7f8c8d;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #95a5a6;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }

        .slot-label { font-size: 12px; font-weight: bold; color: #2c3e50; text-align: center; margin-bottom: 5px; text-transform: uppercase; }

        .physical-slot {
            height: 15px;
            background: #000;
            border-radius: 10px;
            border-bottom: 2px solid #333;
            position: relative;
        }

        .cash-dispenser {
            height: 30px;
            background: #111;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        /* Cash Animation */
        .cash-bill {
            width: 80%;
            height: 90%;
            background: #27ae60;
            margin: 0 auto;
            transform: translateY(-100%);
            transition: transform 1s ease-out;
            border: 1px solid #fff;
        }
        .cash-bill.eject { transform: translateY(0); }

        /* --- PHYSICAL KEYPAD --- */
        .keypad-container {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #bdc3c7;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .pin-screen-mini {
            background: #aab7b8;
            height: 40px;
            margin-bottom: 15px;
            border: 2px solid #7f8c8d;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: monospace;
            font-size: 24px;
            letter-spacing: 5px;
            color: #2c3e50;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .keypad-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .hard-key {
            padding: 15px 0;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            background: #bdc3c7;
            color: #2c3e50;
            cursor: pointer;
            box-shadow: 0 4px 0 #7f8c8d, 0 5px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .hard-key:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #7f8c8d, inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .key-clear { background: #f1c40f; color: white; border-bottom-color: #d4ac0d; }
        .key-cancel { background: #e74c3c; color: white; border-bottom-color: #c0392b; }
        .key-enter { background: #27ae60; color: white; border-bottom-color: #1e8449; height: 100%; grid-row: span 2; display: flex; align-items: center; justify-content: center; }
        .key-blank { background: #95a5a6; cursor: default; box-shadow: none; }

        .screen-input {
            background: transparent;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-size: 24px;
            padding: 10px;
            width: 80%;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        /* --- MODES STYLING --- */
        
        /* Kids Mode Override */
        .screen-container.kids-theme {
            background: #87CEEB;
            background-image: none;
        }
        .screen-container.kids-theme .screen {
            color: #fff;
            text-shadow: 2px 2px 0 #000;
        }
        .screen-container.kids-theme .screen-btn {
            background: #FFD700;
            color: #d35400;
            border: 4px solid #fff;
            border-radius: 20px;
            font-family: 'Comic Sans MS', sans-serif;
            box-shadow: 0 4px 0 #d35400;
            margin-bottom: 15px;
        }
        .screen-container.kids-theme .screen h2 { border-color: #fff; }

        /* Special Case Override */
        .screen-container.special-theme {
            background: #000;
            background-image: none;
        }
        .screen-container.special-theme .screen {
            color: #ffff00; /* High Contrast Yellow */
            text-shadow: none;
        }
        .screen-container.special-theme .screen-btn {
            border: 4px solid #ffff00;
            color: #ffff00;
            font-size: 26px; /* Extra Large Text */
            font-weight: 900;
        }
        .screen-container.special-theme h2 { font-size: 34px; text-decoration: underline; border: none; }

        /* Receipt */
        .receipt-paper {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            width: 250px;
            background: white;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: black;
            text-shadow: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: transform 1.5s ease-out;
            z-index: 10;
        }
        .receipt-paper.print { transform: translateX(-50%) translateY(0); }

    </style>
    </head>
    <body>

        <div class="atm-chassis">
            <div class="monitor-bezel">
                <div class="brand-logo">NIKO SYSTEMS /// ATM-2000</div>

                <div class="screen-container" id="screenContainer">

                    <div class="screen active" id="welcomeScreen">
                        <h2 style="font-size: 40px;">üè¶</h2>
                        <h2 data-key="welcome">Welcome to NIKO'S ATM</h2>
                        <p data-key="selectLang"
                            style="margin-bottom: 20px;">Please select
                            language</p>
                        <button class="screen-btn"
                            onclick="selectLanguage('english')">üá¨üáß
                            ENGLISH</button>
                        <button class="screen-btn"
                            onclick="selectLanguage('urdu')">üáµüá∞ URDU
                            (ÿßÿ±ÿØŸà)</button>
                    </div>

                    <div class="screen" id="modeScreen">
                        <h2 data-key="selectMode">SELECT MODE</h2>
                        <button class="screen-btn" data-key="stdMode"
                            onmouseover="voiceHover(this)"
                            onclick="selectMode('standard')">Standard
                            Mode</button>
                        <button class="screen-btn" data-key="kidsMode"
                            onmouseover="voiceHover(this)"
                            onclick="selectMode('kids')">üß∏ Kids Mode</button>
                        <button class="screen-btn" data-key="specialCase"
                            onmouseover="voiceHover(this)"
                            onclick="selectMode('special')">üëÅÔ∏è Special
                            Case</button>
                    </div>

                    <div class="screen" id="pinScreen">
                        <h2 data-key="enterPin">ENTER PIN</h2>
                        <p data-key="useKeypad"
                            style="font-size: 14px; margin-bottom: 10px;">Use
                            the Keypad below</p>
                        <div style="font-size: 40px; letter-spacing: 10px;"
                            id="screenPinDisplay">_ _ _ _</div>
                        <p data-key="or" style="margin-top: 20px;">OR</p>
                        <button class="screen-btn" data-key="scanFinger"
                            onclick="fingerprintAuth()">üëÜ SCAN
                            FINGERPRINT</button>
                    </div>

                    <div class="screen" id="mainMenuScreen">
                        <h2 data-key="mainMenu">MAIN MENU</h2>
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%;">
                            <button class="screen-btn" data-key="withdraw"
                                onmouseover="voiceHover(this)"
                                onclick="goToScreen('withdrawScreen')">Withdraw</button>
                            <button class="screen-btn" data-key="deposit"
                                onmouseover="voiceHover(this)"
                                onclick="goToScreen('depositScreen')">Deposit</button>
                            <button class="screen-btn" data-key="balance"
                                onmouseover="voiceHover(this)"
                                onclick="checkBalance()">Balance</button>
                            <button class="screen-btn" data-key="transfer"
                                onmouseover="voiceHover(this)"
                                onclick="alert('Feature coming soon')">Transfer</button>
                        </div>
                        <button class="screen-btn" data-key="exit"
                            style="margin-top: 10px; border-color: #e74c3c; color: #e74c3c;"
                            onclick="exitATM()">EXIT CARD</button>
                    </div>

                    <div class="screen" id="withdrawScreen">
                        <h2 data-key="selectAmount">SELECT AMOUNT</h2>
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%;">
                            <button class="screen-btn"
                                onclick="selectWithdrawAmount(1000)">1000</button>
                            <button class="screen-btn"
                                onclick="selectWithdrawAmount(2000)">2000</button>
                            <button class="screen-btn"
                                onclick="selectWithdrawAmount(5000)">5000</button>
                            <button class="screen-btn" data-key="other"
                                onclick="goToScreen('customAmountScreen')">Other</button>
                        </div>
                        <button class="screen-btn" data-key="cancel"
                            style="margin-top: 10px;"
                            onclick="goToScreen('mainMenuScreen')">Cancel</button>
                    </div>

                    <div class="screen" id="customAmountScreen">
                        <h2 data-key="enterAmount">ENTER AMOUNT</h2>
                        <input type="number" class="screen-input"
                            id="customInput" placeholder="0">
                        <p data-key="useKeypadInput"
                            style="font-size: 12px; margin-top: 10px;">Use
                            Keypad to type</p>
                        <div
                            style="display: flex; gap: 10px; width: 100%; margin-top: 20px;">
                            <button class="screen-btn" data-key="confirm"
                                onclick="confirmCustomAmount()">Confirm</button>
                            <button class="screen-btn" data-key="back"
                                onclick="goToScreen('withdrawScreen')">Back</button>
                        </div>
                    </div>

                    <div class="screen" id="messageScreen">
                        <h2 data-key="processing"
                            id="msgTitle">PROCESSING...</h2>
                        <p id="msgText">Please wait</p>
                    </div>

                    <div class="receipt-paper" id="receipt">
                        <center><strong>NIKO BANK</strong></center>
                        <hr style="border-top: 1px dashed black;">
                        <p>Date: <span id="rDate"></span></p>
                        <p>Type: <span id="rType"></span></p>
                        <p>Amt: Rs. <span id="rAmt"></span></p>
                        <p>Bal: Rs. <span id="rBal"></span></p>
                        <hr style="border-top: 1px dashed black;">
                        <center>Thank You!</center>
                    </div>

                </div>
            </div>

            <div class="hardware-panel">

                <div class="slot-group">
                    <div class="slot-label">Card Reader</div>
                    <div class="physical-slot" id="cardSlot"></div>
                </div>

                <div class="slot-group">
                    <div class="slot-label">Cash Dispenser</div>
                    <div class="cash-dispenser">
                        <div class="cash-bill" id="cashBill"></div>
                    </div>
                </div>

                <div class="keypad-container">
                    <div class="pin-screen-mini" id="miniPinDisplay"></div>

                    <div class="keypad-grid">
                        <button class="hard-key"
                            onclick="pressKey('1')">1</button>
                        <button class="hard-key"
                            onclick="pressKey('2')">2</button>
                        <button class="hard-key"
                            onclick="pressKey('3')">3</button>
                        <button class="hard-key key-cancel"
                            onclick="keypadAction('cancel')">‚ùå</button>

                        <button class="hard-key"
                            onclick="pressKey('4')">4</button>
                        <button class="hard-key"
                            onclick="pressKey('5')">5</button>
                        <button class="hard-key"
                            onclick="pressKey('6')">6</button>
                        <button class="hard-key key-clear"
                            onclick="keypadAction('clear')">‚ö†Ô∏è</button>

                        <button class="hard-key"
                            onclick="pressKey('7')">7</button>
                        <button class="hard-key"
                            onclick="pressKey('8')">8</button>
                        <button class="hard-key"
                            onclick="pressKey('9')">9</button>
                        <button class="hard-key key-enter"
                            onclick="keypadAction('enter')">‚úÖ</button>

                        <button class="hard-key key-blank"></button>
                        <button class="hard-key"
                            onclick="pressKey('0')">0</button>
                        <button class="hard-key key-blank"></button>
                    </div>
                </div>
            </div>

        </div>

        <script>
        // --- TRANSLATION DATABASE ---
        const langData = {
            english: {
                welcome: "Welcome to NIKO'S ATM",
                selectLang: "Please select language",
                selectMode: "SELECT MODE",
                stdMode: "Standard Mode",
                kidsMode: "üß∏ Kids Mode",
                specialCase: "üëÅÔ∏è Special Case",
                enterPin: "ENTER PIN",
                useKeypad: "Use the Keypad below",
                or: "OR",
                scanFinger: "üëÜ SCAN FINGERPRINT",
                mainMenu: "MAIN MENU",
                withdraw: "Withdraw",
                deposit: "Deposit",
                balance: "Balance Check",
                transfer: "Transfer",
                exit: "EXIT CARD",
                selectAmount: "SELECT AMOUNT",
                other: "Other Amount",
                enterAmount: "ENTER AMOUNT",
                useKeypadInput: "Use Keypad to type",
                confirm: "Confirm",
                back: "Back",
                cancel: "Cancel",
                processing: "PROCESSING...",
                wait: "Please wait",
                insufficient: "Insufficient Balance",
                takeCash: "Please take your cash",
                balanceMsg: "Your Balance is Rs. "
            },
            urdu: {
                welcome: "ÿÆŸàÿ¥ ÿ¢ŸÖÿØ€åÿØ",
                selectLang: "ÿ≤ÿ®ÿßŸÜ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫",
                selectMode: "ŸÖŸà⁄à ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫",
                stdMode: "ŸÖÿπ€åÿßÿ±€å ŸÖŸà⁄à",
                kidsMode: "ÿ®⁄ÜŸà⁄∫ ⁄©ÿß ŸÖŸà⁄à",
                specialCase: "ÿÆÿµŸàÿµ€å ⁄©€åÿ≥ (Special Case)",
                enterPin: "ÿßŸæŸÜÿß ⁄©Ÿà⁄à ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫",
                useKeypad: "⁄©€å Ÿæ€å⁄à ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ±€å⁄∫",
                or: "€åÿß",
                scanFinger: "ŸÅŸÜ⁄Øÿ± Ÿæÿ±ŸÜŸπ ÿßÿ≥⁄©€åŸÜ ⁄©ÿ±€å⁄∫",
                mainMenu: "ŸÖ€åŸÜ ŸÖ€åŸÜŸà",
                withdraw: "ÿ±ŸÇŸÖ ŸÜ⁄©ÿßŸÑ€å⁄∫",
                deposit: "ÿ¨ŸÖÿπ ⁄©ÿ±€å⁄∫",
                balance: "ÿ®€åŸÑŸÜÿ≥ ⁄Ü€å⁄©",
                transfer: "ŸÖŸÜÿ™ŸÇŸÑ€å",
                exit: "⁄©ÿßÿ±⁄à ŸÜ⁄©ÿßŸÑ€å⁄∫",
                selectAmount: "ÿ±ŸÇŸÖ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫",
                other: "ÿØŸàÿ≥ÿ±€å ÿ±ŸÇŸÖ",
                enterAmount: "ÿ±ŸÇŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫",
                useKeypadInput: "ŸÑ⁄©⁄æŸÜ€í ⁄©€í ŸÑ€å€í ⁄©€å Ÿæ€å⁄à ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ±€å⁄∫",
                confirm: "ÿ™ÿµÿØ€åŸÇ ⁄©ÿ±€å⁄∫",
                back: "ŸàÿßŸæÿ≥",
                cancel: "ŸÖŸÜÿ≥ŸàÿÆ ⁄©ÿ±€å⁄∫",
                processing: "⁄©ÿßÿ±ÿ±Ÿàÿßÿ¶€å ÿ¨ÿßÿ±€å €Å€í...",
                wait: "ÿ®ÿ±ÿß€Å ŸÖ€Åÿ±ÿ®ÿßŸÜ€å ÿßŸÜÿ™ÿ∏ÿßÿ± ⁄©ÿ±€å⁄∫",
                insufficient: "ŸÜÿß⁄©ÿßŸÅ€å ÿ®€åŸÑŸÜÿ≥",
                takeCash: "ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßŸæŸÜ€å ÿ±ŸÇŸÖ ŸàÿµŸàŸÑ ⁄©ÿ±€å⁄∫",
                balanceMsg: "ÿ¢Ÿæ ⁄©ÿß ŸÖŸàÿ¨ŸàÿØ€Å ÿ®€åŸÑŸÜÿ≥ €Å€í: "
            }
        };

        // --- SOUND ENGINE (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'beep') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'enter') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            }
        }

        // --- STATE VARIABLES ---
        let currentLang = 'english';
        let currentPin = "";
        let balance = 50000;
        let activeInputId = null;
        let isSpecialMode = false;
        let synth = window.speechSynthesis;

        // --- NAVIGATION & LANGUAGE ---
        function goToScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const activeScreen = document.getElementById(id);
            activeScreen.classList.add('active');
            
            if(id === 'customAmountScreen') activeInputId = 'customInput';
            else activeInputId = null;

            // Announce Screen Title in Special Mode
            if(isSpecialMode) {
                const title = activeScreen.querySelector('h2');
                if (title) {
                    const txt = title.innerText;
                    speak(txt);
                }
            }
        }

        function selectLanguage(lang) {
            currentLang = lang;
            updateUIText();
            playSound('enter');
            goToScreen('modeScreen');
            if(lang === 'english') speak("Language set to English.");
            else speak("Zaban Urdu muntakhib ki gayi hai."); // Roman Urdu for immediate feedback
        }

        function updateUIText() {
            const data = langData[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (data[key]) el.innerText = data[key];
            });
        }

        function selectMode(mode) {
            playSound('enter');
            const container = document.getElementById('screenContainer');
            
            container.classList.remove('kids-theme', 'special-theme');
            isSpecialMode = false;

            if (mode === 'kids') {
                container.classList.add('kids-theme');
            } else if (mode === 'special') {
                container.classList.add('special-theme');
                isSpecialMode = true;
                
                if (currentLang === 'urdu') {
                    speak("Special Case activate ho gaya hai. Awaz ki madad shuru hai.");
                } else {
                    speak("Special Case Activated. Voice guidance enabled.");
                }
            }

            goToScreen('pinScreen');
        }

        // --- VOICE ENGINE (With Urdu Support) ---
        function speak(text) {
            if(!isSpecialMode) return;
            
            synth.cancel(); // Interrupt previous
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (currentLang === 'urdu') {
                utterance.lang = 'ur-PK'; // Try to set Urdu
                // If text is pure English numbers (like 5000), it's fine.
            } else {
                utterance.lang = 'en-US';
            }
            
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            synth.speak(utterance);
        }

        function voiceHover(element) {
            if(isSpecialMode) {
                // Read the text inside the button
                speak(element.innerText);
            }
        }

        // --- KEYPAD LOGIC ---
        function pressKey(key) {
            playSound('beep');
            if(isSpecialMode) speak(key); // Echo key press

            if (activeInputId) {
                const input = document.getElementById(activeInputId);
                input.value += key;
                return;
            }

            const pinScreen = document.getElementById('pinScreen');
            if (pinScreen.classList.contains('active')) {
                if (currentPin.length < 4) {
                    currentPin += key;
                    updatePinDisplay();
                }
            }
        }

        function keypadAction(action) {
            if (action === 'clear') {
                playSound('error');
                if(isSpecialMode) speak("Clear");
                if (activeInputId) document.getElementById(activeInputId).value = "";
                else {
                    currentPin = "";
                    updatePinDisplay();
                }
            } 
            else if (action === 'cancel') {
                playSound('error');
                if(isSpecialMode) speak("Cancel");
                currentPin = "";
                updatePinDisplay();
                if(activeInputId) goToScreen('withdrawScreen');
            } 
            else if (action === 'enter') {
                playSound('enter');
                if(isSpecialMode) speak("Enter");
                const pinScreen = document.getElementById('pinScreen');
                if (pinScreen.classList.contains('active')) {
                    if (currentPin.length === 4) {
                        goToScreen('mainMenuScreen');
                        currentPin = "";
                        updatePinDisplay();
                    } else {
                        alert("Invalid PIN");
                        currentPin = "";
                        updatePinDisplay();
                    }
                } else if (activeInputId === 'customInput') {
                    confirmCustomAmount();
                }
            }
        }

        function updatePinDisplay() {
            const screenDisp = document.getElementById('screenPinDisplay');
            const miniDisp = document.getElementById('miniPinDisplay');
            
            let masked = "*".repeat(currentPin.length);
            screenDisp.innerText = currentPin.length > 0 ? masked : "_ _ _ _";
            miniDisp.innerText = currentPin; 
        }

        function fingerprintAuth() {
            playSound('beep');
            if(isSpecialMode) speak(currentLang === 'urdu' ? "Fingerprint scan ho raha hai" : "Scanning fingerprint");
            setTimeout(() => { playSound('enter'); goToScreen('mainMenuScreen'); }, 1000);
        }

        // --- TRANSACTION LOGIC ---
        function checkBalance() {
            playSound('enter');
            const msgTitle = document.getElementById('msgTitle');
            const msgText = document.getElementById('msgText');
            
            // Set text manually to ensure dynamic variable included
            if(currentLang === 'urdu') {
                msgTitle.innerText = "ÿ®€åŸÑŸÜÿ≥";
                msgText.innerText = "ÿ¢Ÿæ ⁄©ÿß ÿ®€åŸÑŸÜÿ≥ €Å€í: \nRs. " + balance;
                if(isSpecialMode) speak("Aap ka balance hai " + balance + " rupay");
            } else {
                msgTitle.innerText = "BALANCE";
                msgText.innerText = "Current Balance:\nRs. " + balance;
                if(isSpecialMode) speak("Your balance is " + balance + " rupees");
            }

            goToScreen('messageScreen');
            setTimeout(() => goToScreen('mainMenuScreen'), 3500);
        }

        function selectWithdrawAmount(amount) {
            processTransaction(amount, 'Withdrawal');
        }

        function confirmCustomAmount() {
            const val = document.getElementById('customInput').value;
            if (val > 0) processTransaction(parseInt(val), 'Withdrawal');
        }

        function processTransaction(amount, type) {
            if (amount > balance) {
                playSound('error');
                const txt = langData[currentLang].insufficient;
                if(isSpecialMode) speak(txt);
                alert(txt);
                return;
            }

            balance -= amount;
            
            // Show Processing
            goToScreen('messageScreen');
            const data = langData[currentLang];
            document.getElementById('msgTitle').innerText = data.processing;
            document.getElementById('msgText').innerText = data.wait;
            
            playSound('beep');
            if(isSpecialMode) speak(data.processing);

            setTimeout(() => {
                // Eject Cash
                document.getElementById('cashBill').classList.add('eject');
                playSound('enter');
                if(isSpecialMode) speak(data.takeCash);

                printReceipt(type, amount);

                setTimeout(() => {
                    document.getElementById('cashBill').classList.remove('eject');
                    document.getElementById('receipt').classList.remove('print');
                    goToScreen('mainMenuScreen');
                }, 4000);
            }, 2000);
        }

        function printReceipt(type, amount) {
            const r = document.getElementById('receipt');
            const d = new Date();
            document.getElementById('rDate').innerText = d.toLocaleTimeString();
            document.getElementById('rType').innerText = type;
            document.getElementById('rAmt').innerText = amount;
            document.getElementById('rBal').innerText = balance;
            r.classList.add('print');
        }

        function exitATM() {
            playSound('error');
            const bye = currentLang === 'urdu' ? "Shukriya. Apna card wapis len." : "Thank you. Please take your card.";
            if(isSpecialMode) speak(bye);
            
            document.getElementById('cardSlot').style.backgroundColor = '#2ecc71'; 
            goToScreen('welcomeScreen');
            
            // Reset to English default for next user after delay
            setTimeout(() => { 
                currentLang = 'english'; 
                updateUIText(); 
                document.getElementById('cardSlot').style.backgroundColor = '#000'; 
            }, 3000);
        }

        // Initialize Text
        updateUIText();

    </script>
    </body>
</html>